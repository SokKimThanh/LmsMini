# Sprint 2 — 2025-09-15 ? 2025-09-28

M?c tiêu chính

- Thi?t l?p skeleton d? án theo Clean Architecture và chu?n hóa conventions.
- Tri?n khai h? t?ng xác th?c/?y quy?n (ASP.NET Identity + JWT + RBAC).
- C?u h?nh CI cõ b?n, logging, global error handling và DbContext skeleton v?i audit.

T?ng quan ti?n ð? (c?p nh?t theo code hi?n t?i)

- Tr?ng thái t?ng: m?t ph?n ð? hoàn thành, nhi?u task c?n "Not Started".
- Ðánh giá hi?n t?i: ~30% complete (d?a trên các file có trong repo: Program.cs, LmsDbContext, entity AspNetUser).

Nh?ng g? ð? có / Done

- Program.cs: ð? ðãng k? Serilog, DbContext (LmsDbContext), AutoMapper, MediatR, FluentValidation, Swagger và Serilog request logging.
  - File: `LmsMini.Api/Program.cs`.
- LmsDbContext: t?n t?i v?i nhi?u DbSet, c?u h?nh RowVersion, default value và filtered indexes.
  - File: `LmsMini.Infrastructure/Persistence/LmsDbContext.cs`.
- Domain: AspNetUser entity và mapping có s?n.
  - File: `LmsMini.Domain/Entities/Identity/AspNetUser.cs`.

Nh?ng task c?n thi?u / Not Started

- Tích h?p ASP.NET Identity runtime (AddIdentity / AddEntityFrameworkStores) trong Program.cs.
- JwtService (t?o/validate token), IDateTimeProvider, CurrentUserService chýa có.
- Register / Login endpoints (DTO, Command/Handler, Controller) chýa có.
- Role seeding (Admin/Instructor/Learner) và admin user seed chýa có.
- Migration cho Identity chýa t?o/áp d?ng.
- Global Error Handling Middleware (Response Envelope) chýa t?n t?i.
- CI workflow (.github/workflows) chýa có.
- Unit / Integration tests cho auth chýa có.

Chi ti?t tr?ng thái các task (týõng ?ng danh sách ban ð?u)

1. T?o solution skeleton & project structure — Done
2. Thi?t l?p project conventions — Not Started
3. Thi?t l?p CI (basic) — Not Started
4. Cài ð?t package cõ b?n — Partially Done (packages ðãng k? trong Program.cs nhýng ki?m tra csproj c?n)
5. C?u h?nh DI & bootstrap (Program.cs) — Done (core services ðãng k?)
6. Global Error Handling Middleware — Not Started
7. Logging + correlationId/traceId — Partially Done (Serilog và UseSerilogRequestLogging t?n t?i; chýa có correlationId middleware explicit)
8. BaseAuditable & DbContext skeleton — Done (LmsDbContext có audit fields)
9. ASP.NET Identity integration — Not Started (entity có, nhýng runtime integration chýa)
10. EF Core migration initial for Identity — Not Started
11. Repository interfaces for Auth — Not Started
12. IDateTimeProvider & CurrentUserService — Not Started
13. Password/security helpers — Not Started (can use Identity defaults)
14. JWT token service — Not Started
15. Role seeding & admin seed — Not Started
16. Register endpoint — Not Started
17. Login endpoint — Not Started
18. RBAC wiring (policies) — Not Started
19. Unit tests (Auth services) — Not Started
20. Unit tests (Controllers/Handlers) — Not Started
21. Swagger OpenAPI auth docs — Partially Done (Swagger registered with Bearer scheme in Program.cs)

Ýu tiên ng?n h?n (next steps)

1. Ðãng k? ASP.NET Identity trong Program.cs và AddEntityFrameworkStores<LmsDbContext>().
2. T?o migration cho Identity và áp vào local DB (dotnet ef migrations add Init_Identity ...).
3. Thêm JwtService skeleton (create/validate) và c?u h?nh signing key t? appsettings (ho?c user-secrets).
4. T?o Register & Login minimal endpoints (DTOs + handler) ð? test end-to-end.
5. Thêm Role seeder (idempotent) và seed admin.
6. Vi?t Global Error Middleware ðõn gi?n tr? Response Envelope.
7. T?o file .github/workflows/ci.yml m?u (restore/build/test).

L?nh tham kh?o ð? dev ch?y local

- Cài công c? EF (n?u c?n):
  ```bash
  dotnet tool install --global dotnet-ef
  ```

- T?o migration (sau khi ð? tích h?p Identity):
  ```bash
  dotnet ef migrations add Init_Identity -s LmsMini.Api -p LmsMini.Infrastructure
  ```

- Áp migration vào DB local:
  ```bash
  dotnet ef database update -s LmsMini.Api -p LmsMini.Infrastructure
  ```

- Ch?y API local:
  ```bash
  dotnet run --project LmsMini.Api
  ```

G?i ? phân công & ý?c lý?ng ng?n (cho 1 dev)

- Identity + JwtService + Register/Login + Role seed + migration: 2–3 ngày.
- Error middleware, traceId, Serilog fine-tune: 0.5–1 ngày.
- CI workflow + basic tests: 1 ngày.

Ghi chú cho reviewer

- Ki?m tra Program.cs khi thêm Identity: không commit keys; dùng user-secrets cho local.
- Khi t?o migration, review file migration trý?c khi apply.
- Thêm unit tests nh? cho JwtService và handler ð? ð?m b?o behavior.

Mu?n tôi ti?p t?c th?c hi?n ph?n nào ngay bây gi??
- A: Thêm c?u h?nh Identity (Program.cs) + migration skeleton
- B: T?o JwtService + DTOs + Login/Register handler skeleton
- C: T?o .github/workflows/ci.yml m?u

Tr? l?i A/B/C ð? m?nh b?t tay th?c hi?n.